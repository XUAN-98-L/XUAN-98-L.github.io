<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605469 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="8267"/>

<div>
<span><div style="font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 153); color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">针对去批次之后的结果：DOE20226213_瞿介明_姜艳山老师_20230506-去批次\MNN_Clustering</span></div><div style="font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br/></div><div style="font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">1. 分别针对</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(0, 0, 0, 0); color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">NC/LOW/HIGH</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(0, 0, 0, 0); color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">各做</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(0, 0, 0, 0); color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">一个dotplot图，横坐标cluster1-8，纵坐标附件sheet1基因，</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(0, 0, 0, 0); color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">3张</span></div><div style="font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"><img src="houxu20230728_files/Image.png" type="image/png" data-filename="Image.png"/></span></span></div><div style="font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">2. </span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(0, 0, 0, 0); color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">NC/LOW/HIGH</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(0, 0, 0, 0); color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">分别</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(0, 0, 0, 0); color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">做相关性图，横坐标：</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(0, 0, 0, 0); color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">CD69的表达量；纵坐标附件sheet4的list【4个list】,</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgba(0, 0, 0, 0); color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei UI&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">3组 x 4 list=14张</span></div><div style="font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 11pt;"><img src="houxu20230728_files/Image [1].png" type="image/png" data-filename="Image.png"/></span></div><div style="letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></div><div style="letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#工作路径</div><div>/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728</div><div><br/></div><div># 去批次结果</div><div>/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230506/MNN/seurat.h5seurat</div><div><br/></div><div>#先转rds</div><div>module load OESingleCell/3.0.d &amp;&amp; Rscript /public/scRNA_works/works/intern/pengjiale/project/scVDJ/DOE202211197-b5/scrna_pipeline/scripts/R/v4tov3.r -i /public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230506/MNN/seurat.h5seurat -f h5seurat -o ./rds &amp;&amp; module unload OESingleCell/3.0.d &amp;&amp; module load OESingleCell/2.0.0 &amp;&amp; Rscript /public/scRNA_works/works/intern/pengjiale/project/scVDJ/DOE202211197-b5/scrna_pipeline/scripts/R/v4tov3.r -o ./rds</div><div><br/></div><div>1. 分别针对NC/LOW/HIGH各做一个dotplot图，横坐标cluster1-8，纵坐标附件sheet1基因，3张</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">seurat_ob = readRDS(&quot;</span>/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/rds/data_ob_v3.rds&quot;)</div><div><br/></div><div>setwd(&quot;/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/group&quot;)</div><div><br/></div><div>for (i in unique(seurat_ob@meta.data$group)){</div><div>    print(i)</div><div>    subset_data = subset(seurat_ob, group == i)</div><div>     outfilename = paste0(i,&quot;.rds&quot;)</div><div>     saveRDS(subset_data,file = outfilename)</div><div>     print(paste0(&quot;Group&quot;,i,&quot; Finished&quot;))</div><div>}</div><div><br/></div><div><br/></div><div>#R脚本添加coord_flip()</div><div>module load OESingleCell/2.0.0</div><div>for i in {LOW,HIGH,CON};do</div><div>Rscript visualize_markers.R  -v /public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/group/$i.rds -x /public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/sheet1.txt -o $i  -m dotplot  -s 0 -e RNA -g clusters --reduct tsne</div><div>done</div><div><br/></div><div><br/></div><div>2. NC/LOW/HIGH分别做相关性图，横坐标：CD69的表达量；纵坐标附件sheet4的list【4个list】,3组 x 4 list=14张</div><div>#先做打分</div><div>module purge &amp;&amp; module load OESingleCell/2.0.0</div><div>for i in {LOW,HIGH,CON};do</div><div>mkdir $i</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">for j in {</span>Pyroptosis,Necroptosis,Ferroptosis,Apoptosis<span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">};do</span></div><div>Rscript /home/luyao/10X_scRNAseq_v3/src/Diffexp/visualize_markers.R  -v /public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/group/$i.rds -x /public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/$j.txt -o $i/$j  -m geneset  -s 0 -e RNA -g clusters --reduct tsne</div><div>done</div><div>done</div><div><br/></div><div>#相关性图参考美云脚本，修改配色啥的</div><div>/public/scRNA_works/works/lumeiyun/project/scRNA/DOE20228053-pig/houxu20221219/run.r</div><div><br/></div><div>##分析脚本</div><div>setwd(&quot;/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/2.Plot&quot;)</div><div><br/></div><div>sample = c(&quot;LOW&quot;,&quot;HIGH&quot;,&quot;CON&quot;)</div><div>geneset = c(&quot;Pyroptosis&quot;,&quot;Necroptosis&quot;,&quot;Ferroptosis&quot;,&quot;Apoptosis&quot;)</div><div>for (i in sample){</div><div>dir.create(paste0(&quot;/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/2.Plot/&quot;,i,sep = &quot;&quot;))</div><div>rds_path = paste0(&quot;/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/group/&quot;,i,&quot;.rds&quot;,sep = &quot;&quot;)</div><div>seurat_ob = readRDS(rds_path)</div><div>data = FetchData(seurat_ob, vars =c(&quot;rawbc&quot;,&quot;Cd69&quot;))</div><div><br/></div><div>for (j in geneset){</div><div>dir.create(paste0(&quot;/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/2.Plot/&quot;,i,&quot;/&quot;,j,sep = &quot;&quot;))</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><br/></div><div>df = read.delim(paste0(&quot;/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/Addmodulescore/&quot;,i,&quot;/&quot;,j,&quot;/geneset_visualization/geneset.addmodeulescore.xls&quot;,sep = &quot;&quot;))</div><div><br/></div><div>plot_df = df %&gt;% left_join(data, by = c(&quot;Barcode&quot; = &quot;rawbc&quot;))</div><div><br/></div><div><br/></div><div>p &lt;- ggplot(plot_df ,aes(Cd69,extra))+</div><div>theme_bw()+theme(panel.grid = element_blank())+</div><div>theme(axis.title.x = element_text(size = 14),axis.title.y = element_text(size = 14),  axis.text.x = element_text(color=&quot;black&quot;,face = &quot;bold&quot;) , axis.text.y = element_text(color=&quot;black&quot;) )+  xlab(&quot;Cd69&quot;)+ylab(j)+geom_point(cex=1,color=&quot;#F7D849&quot;)+ geom_smooth(se=TRUE,color = &quot;#F7D849&quot;,size=1,method=&quot;lm&quot;,fill = &quot;#F7D849&quot;)+stat_cor(data=plot_df, method = &quot;pearson&quot;)</div><div><br/></div><div>ggsave(paste0(&quot;/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/2.Plot/&quot;,i,&quot;/&quot;,j,&quot;/Plot.png&quot;,sep = &quot;&quot;),p)</div><div>ggsave(paste0(&quot;/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/2.Plot/&quot;,i,&quot;/&quot;,j,&quot;/Plot.pdf&quot;,sep = &quot;&quot;),p)</div><div><br/></div><div>write.table(plot_df, quote = F,sep =&quot;,&quot;,row.names = F,paste0(&quot;/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/2.Plot/&quot;,i,&quot;/&quot;,j,&quot;/data.csv&quot;,sep = &quot;&quot;))</div><div>}</div><div>}</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>#############绘图测试脚本</div><div>seurat_ob = readRDS(&quot;/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/group/LOW.rds&quot;)</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">data = FetchData(seurat_ob, vars =c(&quot;rawbc&quot;,</span>&quot;Cd69&quot;<span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">))</span></div><div><br/></div><div><br/></div><div>df = read.delim(&quot;/public/scRNA_works/works/liuxuan/Project/conjoint/DOE20226213_Mouse/houxu20230728/Addmodulescore/LOW/Necroptosis/geneset_visualization/geneset.addmodeulescore.xls&quot;)</div><div><br/></div><div><br/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">plot_df = df %&gt;% left_join(data, by = c(&quot;</span>Barcode&quot; = &quot;rawbc&quot;<span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">))</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div>library(reshape2)</div><div>library(ggpubr)</div><div>library(Seurat)</div><div>library(ggplot2)</div><div>library(dplyr)</div><div>library(tibble)</div><div>require(&quot;ggrepel&quot;)</div><div>library(ggpubr)</div><div>library(ggpubr)</div><div><br/></div><div>j = &quot;Necroptosis&quot;</div><div><br/></div><div><br/></div><div>p &lt;- ggplot(plot_df ,aes(Cd69,extra))+</div><div> theme_bw()+theme(panel.grid = element_blank())+</div><div> theme(axis.title.x = element_text(size = 14),axis.title.y = element_text(size = 14),  axis.text.x = element_text(color=&quot;black&quot;,face = &quot;bold&quot;) , axis.text.y = element_text(color=&quot;black&quot;) )+  xlab(&quot;Cd69&quot;)+ylab(j)+geom_point(cex=1,color=&quot;#F7D849&quot;)+ geom_smooth(se=TRUE,color = &quot;#F7D849&quot;,size=1,method=&quot;lm&quot;,fill = &quot;#F7D849&quot;)+stat_cor(data=plot_df, method = &quot;pearson&quot;)</div><div><br/></div><div>ggsave(&quot;test.png&quot;,p)</div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></div><div style="letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 